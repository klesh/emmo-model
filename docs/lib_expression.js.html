<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>emmo-model.js: Source: lib/expression.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <style type="text/css">
      h1, h2, h3 {
        margin-top: 20px;
        margin-bottom: 20px;
      }

      h4 {
        padding-top: 20px;
        border-top: 2px solid #999;
      }
    </style>
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/expression.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * SQL operator/function wrapper
 *   1. when expr is string, this string will be put in SQL honestly
 *   2. when expr is function, it will be call with two arguments:
 *        agent(dialect implementation),
 *        values(sql query params list),
 *        and expect a legal SQL statement to be returned, along with values list is added if needed
 *
 * @constructor
 * @param {string|function}  expr
 */
function Expression(expr, em, type) {
  this.em = em;
  this.expr = expr;
  this.type = type;
  this.isFunction = typeof(expr) === 'function';
  this.suffixes = [];
}

/**
 * Return formatted SQL clause, and push params to values list
 *
 * @returns {string}   SQL statment
 */
Expression.prototype.evaluate = function(builder) {
  var sql = this.isFunction ? this.expr(builder) : this.expr;
  var j = this.suffixes.length;
  if (j > 0) {
    for (var i = 0; i &lt; j; i++) {
      sql += this.suffixes[i](builder);
    }
  }
  return sql;
};

Expression.prototype.op = function(sign, value) {
  this.suffixes.push(function(builder) {
    return sign + builder.element(value);
  });
  return this;
}


/**
 * String concatenation
 *
 * @param {...Expression|string}  value
 * @returns {Expression}
 */
Expression.prototype.concate = function(value) {
  var concator = em.agent.stringConcatenate;
  if (typeof(concator) === 'string') {
    // scenario 1, simple concatenate operator
    this.suffixes.push(function(builder) {
      return concator + builder.element(value);
    });
  } else if (typeof(concator) === 'function') {
    // scenario 2, having function instead of operator
    this.suffixes.push(concator.apply(em.agent, arguments));
  }
  return this;
};

/**
 * Append a mathematical + operation
 *
 * @param {any}  value
 * @returns {Expression}
 */
Expression.prototype.plus = function(v) { return this.op('+', v); };


/**
 * Append a mathematical - operation
 *
 * @param {any}  value
 * @returns {Expression}
 */
Expression.prototype.subtract = function(v) { return this.op('-', v); };

/**
 * Append a mathematical * operation
 *
 * @param {any}  value
 * @returns {Expression}
 */
Expression.prototype.multiply = function(v) { return this.op('*', v); };

/**
 * Append a mathematical / operation
 *
 * @param {any}  value
 * @returns {Expression}
 */
Expression.prototype.divide = function(v) { return this.op('/', v); };

/**
 * Append a mathematical % operation
 *
 * @param {any}  value
 * @returns {Expression}
 */
Expression.prototype.module = function(v) { return this.op('%', v); };

/**
 * Append a mathematical | operation
 *
 * @param {any}  value
 * @returns {Expression}
 */
Expression.prototype.or = function(v) { return this.op('|', v); };

/**
 * Append a mathematical &amp; operation
 *
 * @param {any}  value
 * @returns {Expression}
 */
Expression.prototype.and = function(v) { return this.op('&amp;', v); };

module.exports = Expression;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="EmmoModel.html">EmmoModel</a></li><li><a href="Expression.html">Expression</a></li><li><a href="module.exports-Model.html">Model</a></li><li><a href="Session.html">Session</a></li></ul><h3>Events</h3><ul><li><a href="EmmoModel.html#event:created">created</a></li><li><a href="EmmoModel.html#event:migrated">migrated</a></li><li><a href="EmmoModel.html#event:ready">ready</a></li><li><a href="EmmoModel.html#event:removed">removed</a></li></ul><h3>Global</h3><ul><li><a href="global.html#em">em</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Thu Jul 18 2019 23:36:53 GMT+0800 (China Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
